<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ver Progreso</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='user_progress.css') }}">
</head>
 <header>
        <nav class="navbar">
            <a href="{{ url_for('index') }}" class="logo">FitnessApp</a>
            <ul>
                <li><a href="{{ url_for('rutinas') }}">Mis Rutinas</a></li>
                <li><a href="{{ url_for('crear_rutina') }}">Crear Rutina</a></li>
                <li><a href="{{ url_for('user_progress', usuari_id=session['user_id']) }}">Ver Progreso</a></li>
                {% if session.get('user_id') %}
                <li><a href="{{ url_for('logout') }}" class="btn-logout">Cerrar sesión</a></li>
                {% else %}
                <li><a href="{{ url_for('login') }}" class="btn-login">Iniciar sesión</a></li>
                {% endif %}
            </ul>
        </nav>
    </header>

   <h1>Progreso de {{ nombre_usuario }}</h1>


    <div class="table-container">
        <table id="taulaRutines">
            <thead>
                <tr>
                    <th>Ejercicio</th>
                    <th>Fecha</th>
                    <th>Valor</th>
                    <th>Comentarios</th>
                </tr>
            </thead>
            <tbody>
                {% for progreso in progressos %}
                <tr data-id="{{ loop.index }}">
                    <td>{{ progreso.exercici }}</td>
                    <td>{{ progreso.data }}</td>
                    <td>{{ progreso.valor }}</td>
                    <td>
                        <button class="ver-comentario" data-id="{{ loop.index }}">Ver Comentarios</button>
                        <button class="agregar-comentario" data-id="{{ loop.index }}">Agregar Comentario</button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <div class="comentario-form" id="comentario-form">
        <h3>Agregar Comentario</h3>
        <form method="POST" action="{{ url_for('user_progress', usuari_id=usuari_id) }}">
            <textarea name="comentari" id="comentario-texto" rows="4" cols="50"></textarea><br>
            <button type="submit">Guardar Comentario</button>
        </form>
    </div>

    <div id="comentarios-existing" style="display: none;">
        <h3>Comentarios Existentes:</h3>
        <div id="comentarios-list"></div>
    </div>

    <script>
        document.querySelectorAll('.agregar-comentario').forEach(button => {
            button.addEventListener('click', function () {
                document.getElementById('comentario-form').style.display = 'block';
                document.getElementById('comentarios-existing').style.display = 'none';
            });
        });

        document.querySelectorAll('.ver-comentario').forEach(button => {
            button.addEventListener('click', function () {
                document.getElementById('comentario-form').style.display = 'none';
                document.getElementById('comentarios-existing').style.display = 'block';

                const comentarios = {{ comentaris|tojson }};
                let comentariosHTML = '';
                comentarios.forEach(comentario => {
                    comentariosHTML += `
                        <p>${comentario.comentari} <span>(Fecha: ${comentario.data})</span></p>
                    `;
                });

                document.getElementById('comentarios-list').innerHTML = comentariosHTML;
            });
        });
    </script>
</body>
</html>
